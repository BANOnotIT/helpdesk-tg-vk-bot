# Что происходит в vk.py?

Как вы могли заметить, этот файл (также будем называть его _модуль vk_) называется _vk.py_ и находится в папке _api_. Это наталкивает на мысль, что он тем или иным образом свзяан с [_VK API  для чат-ботов_](https://vk.com/dev/bots_docs). Давайте разберемся, как именно.

## Для чего нужен этот модуль?

![Схема отношений между чат-ботом, ВК и пользователями](https://pp.userapi.com/c830709/v830709219/1d89bf/ppXg6qdVRI4.jpg)

Модуль _vk_ играет роль _посредника_ между основными "мозгами" нашего бота и программным интерфейсом ботов ВКонтакте. Сделано это для того, чтобы сами "мозги" бота (модуль _core_) не были заняты лишними мыслями о том, как правильно работать с _VK API_, и могли спокойно заниматься тем, чем и должны - обработкой сообщений.

Говоря простым языком, модуль _vk_ - это _дипломат_, обеспечивающий нормальные отношения между нашим чат-ботом и серверами ВКонтакте. Этот модуль отвечает за _отправку и получение_ ботом сообщений ВК, а также за то, чтобы наш бот и ВК _понимали_ друг друга. Если вы читали пояснение к _base.py_, то это как раз один из тех мостов, о которых там идет речь.

## Что есть в этом модуле?

### Класс _VkApi_

Этот класс представляет собой частичную _модель_ API для ботов ВКонтакте. Он _наследуется_ от класса _Api_ из модуля _base_ и являеся его доработанной для _VK API_ версией. В нем реализованы особенности, необходимые для работы конкретно с _VK API_.

##### Внутри класса _VkApi_ реализованы:

#### Метод _get_message_()
Этот метод _получает_ сообщения ВК, определяет их _тип_ (новое сообщение, уведомление о новом собеседнике, уведомление об уходе собеседника). В случае, если это уведомление о новом собеседнике,  пользователь добавляется в базу данных бота, и этот факт записывается в журнал событий бота (лог). В качестве _результата_ метод возвращает полученное _сообщение_, которое бот впоследствии будет обрабатывать.

#### Метод _message_()
Этот метод _отправляет_ сообщения ВК. Параметр _message_ - текст сообщения (строка), параметр _chat_ - уникальный номер чата ВК (целое число), в который его нужно отправить. Факт отправки сообщения записывается в журнал событий бота (лог).

#### Метод _exec_()
Этот метод непосредственно используется для обращения к сервисам _VK API_. Он подключается к серверам ВКонтакте, _совершает запрос_ необходимого действия или информации и _получает ответ_. В качестве _результата_ метод возвращает полученный с сервера ответ.

### Класс _VkMessage_
Этот класс представляет собой частичную _модель_ сообщений ВКонтакте. Он _наследуется_ от класса _Message_ из модуля _base_ и является его доработанной для _VK API_ версией. В нем есть все то, что было в его родителе _base.Message_, но также присутствуют некоторые характерные особенности, необходимые для работы конкретно с _сообщениями ВКонтакте_.

##### По наследству от _base.Message_ классу _VkMessage_ достались:

#### Свойство _text_
Текст сообщения.

#### Свойство _user_
Автор сообщения.

#### Свойство _kind_
Тип сообщения.

#### Свойство _chat_
Чат, в который отправлено сообщение.

#### Метод _\_\_repr\_\__()
Этот метод представлет информацию о сообщении в виде строки формата "Сообщение _<типа>_ от _<отправителя>_: _<текст сообщения>_". _Результат_ выполнения - эта строка.

##### Внутри класса _VkMessage_ реализованы:

#### Свойство _platform_
Платформа, через которую отправляется сообщение. Для _VkMessage_ этому свойству соответствует значение _EPlatform.vk_ (то есть ВКонтакте).

#### Метод _reply_()
Этот метод позволяет _ответить_ на данное сообщение ВК, то есть отправить сообщение в тот же _chat_, откуда оно родом. Параметр _message_ - текст сообщения (строка). Этот метод будет удобно использовать в нашем чат-боте при обработке сообщений, вызывая его прямо из самого сообщения.